<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width= device-width, initial-scale=1">
    <title> Endless Runner</title>
    <link rel="stylesheet" href="CSS/styles.css" type="text/css">
   
</head>

<body>
    <h1> Don't Kill Dotty</h1>
    <p>The aim of the game is to keep Dotty alive for as long as you can!</p>
    <br>
   
    <canvas id="canvas" width="640" height="480"></canvas>

    <!--
    <footer>
        Photo by Casey Horner on Unsplash<a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@mischievous_penguins?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Casey Horner"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewBox="0 0 32 32">
                    <title>unsplash-logo</title>
                    <path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path>
                </svg></span><span style="display:inline-block;padding:2px 3px">Casey Horner</span></a>
    </footer>
-->
</body>

<script>
    //    The game screen itself
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    function floor(x, height) {
        this.x = x;
        this.width = 700;
        this.height = height;
    }
    //World object
    var world = {
        height: 480,
        width: 640,
        gravity: 10,
        highestFloor: 240,
        speed: 3,
        distanceTravelled: 0,
        maxSpeed: 25,
        tilesPassed: 0,
        autoScroll: true,
        floorTiles: [new floor(0, 140)],
        stop: function() {
            this.autoScroll = false;
        },
        moveFloor: function() {
            for (index in this.floorTiles) {
                var tile = this.floorTiles[index];
                tile.x -= this.speed;
                this.distanceTravelled += this.speed;
            }
        },
        addFutureTiles: function() {
            if (this.floorTiles.length >= 3) {
                return;
            }
            var previousTile = this.floorTiles[this.floorTiles.length - 1];
            var biggestJumpHeight = previousTile.height + player.height * 3.5;
            if ( biggestJumpHeight > this.highestFloor){
                biggestJumpHeight = this.highestFloor;
            }
            var randomHeight = Math.floor(Math.random() * biggestJumpHeight) + player.height;
            var leftValue = (previousTile.x + previousTile.width);
            var next = new floor(leftValue, randomHeight);
            this.floorTiles.push(next);
        },
        cleanOldTiles: function() {
            for (index in this.floorTiles) {
                if (this.floorTiles[index].x <= -this.floorTiles[index].width) {
                    this.floorTiles.splice(index, 1);
                    this.tilesPassed++;
                    if(this.tilesPassed % 3 == 0 && this.speed < this.maxSpeed){
                        this.speed++;
                    }
                }
            }
        },
        getDistanceToFloor: function(playerX) {
            for (index in this.floorTiles) {
                var tile = this.floorTiles[index];
                if (tile.x <= playerX && tile.x + tile.width >= playerX) {
                    return tile.height;
                }
            }
            return -1;
        },
        tick: function() {
            if (!this.autoScroll) {
                return;
            }
            this.cleanOldTiles();
            this.addFutureTiles();
            this.moveFloor();
        },
        draw: function() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, this.width, this.height);
            for (index in this.floorTiles) {
                var tile = this.floorTiles[index];
                var y = world.height - tile.height;
                ctx.fillStyle = "blue";
                ctx.fillRect(tile.x, y, tile.width, tile.height);
            }
            ctx.fillStyle = "white";
            ctx.font = "28px Arial";
            ctx.fillText("Speed: " + this.speed + "mph", 10, 40);
            ctx.fillText("Distance: " + this.distanceTravelled + "miles", 10, 75);
        }
    };
    //     Player object 
    var player = {
        x: 160,
        y: 340,
        height: 20,
        width: 20,
        downwardForce: world.gravity,
        jumpHeight: 0,
        getDistanceFor: function(x) {
            var platformBelow = world.getDistanceToFloor(x);
            return world.height - this.y - platformBelow;
        },
        applyGravity: function() {
            this.currentDistanceAboveGround = this.getDistanceFor(this.x);
            var rightHandSideDistance = this.getDistanceFor(this.x + this.width);
            if (this.currentDistanceAboveGround < 0 || rightHandSideDistance < 0) {
                world.stop();
            }
        },
        processGravity: function() {
            this.y += this.downwardForce;
            var floorHeight = world.getDistanceToFloor(this.x, this.width);
            var topYofPlatform = world.height - floorHeight;
            if (this.y > topYofPlatform) {
                this.y = topYofPlatform;
            }
            if (this.downwardForce < 0) {
                this.jumpHeight += (this.downwardForce * -1);
                if (this.jumpHeight >= player.height * 6) {
                    this.downwardForce = world.gravity;
                    this.jumpHeight = 0;
                }
            }
        },
//        this is the button to jump
        keyPress: function(keyInfo) {
            var floorHeight = world.getDistanceToFloor(this.x, this.width);
            var onTheFloor = floorHeight == (world.height - this.y);
            if (onTheFloor) {
                this.downwardForce = -8;
            }
        },
        tick: function() {
            this.processGravity();
            this.applyGravity();
        },
        draw: function() {
            ctx.fillStyle = "green";
            ctx.fillRect(player.x, player.y - player.height, this.height, this.width);
        }
    };
    window.addEventListener("keypress", function(keyInfo) {
        player.keyPress(keyInfo);
    }, false);

    function tick() {
        player.tick();
        world.tick();
        world.draw();
        player.draw();
        window.setTimeout("tick()", 1000 / 60);
    }
    tick();
</script>
</html>

